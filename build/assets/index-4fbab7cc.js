import{fh as d,fk as b,fg as q,fi as g,g0 as ne,gq as $,gr as se,gs as ie,g9 as R,gt as le,gu as H,gc as ue,fn as y,g4 as he,gv as M,g6 as S,gw as de,gx as fe,gy as pe}from"./index-fc282d72.js";import{gC as Ge,gA as He,gz as Me,gB as Ke}from"./index-fc282d72.js";import{aP as P}from"./wallet-connection-1adc2104.js";import{aQ as Ve}from"./wallet-connection-1adc2104.js";import"./index-0e0e7991.js";let I=null;try{if(I=WebSocket,I==null)throw new Error("inject please")}catch{const t=new d(b);I=function(){t.throwError("WebSockets not supported in this environment",d.errors.UNSUPPORTED_OPERATION,{operation:"new WebSocket()"})}}var L=globalThis&&globalThis.__awaiter||function(n,t,e,r){function o(s){return s instanceof e?s:new e(function(i){i(s)})}return new(e||(e=Promise))(function(s,i){function a(u){try{l(r.next(u))}catch(f){i(f)}}function c(u){try{l(r.throw(u))}catch(f){i(f)}}function l(u){u.done?s(u.value):o(u.value).then(a,c)}l((r=r.apply(n,t||[])).next())})};const A=new d(b);let ge=1;class W extends q{constructor(t,e){e==="any"&&A.throwError("WebSocketProvider does not support 'any' network yet",d.errors.UNSUPPORTED_OPERATION,{operation:"network:any"}),typeof t=="string"?super(t,e):super("_websocket",e),this._pollingInterval=-1,this._wsReady=!1,typeof t=="string"?g(this,"_websocket",new I(this.connection.url)):g(this,"_websocket",t),g(this,"_requests",{}),g(this,"_subs",{}),g(this,"_subIds",{}),g(this,"_detectNetwork",super.detectNetwork()),this.websocket.onopen=()=>{this._wsReady=!0,Object.keys(this._requests).forEach(o=>{this.websocket.send(this._requests[o].payload)})},this.websocket.onmessage=o=>{const s=o.data,i=JSON.parse(s);if(i.id!=null){const a=String(i.id),c=this._requests[a];if(delete this._requests[a],i.result!==void 0)c.callback(null,i.result),this.emit("debug",{action:"response",request:JSON.parse(c.payload),response:i.result,provider:this});else{let l=null;i.error?(l=new Error(i.error.message||"unknown error"),g(l,"code",i.error.code||null),g(l,"response",s)):l=new Error("unknown error"),c.callback(l,void 0),this.emit("debug",{action:"response",error:l,request:JSON.parse(c.payload),provider:this})}}else if(i.method==="eth_subscription"){const a=this._subs[i.params.subscription];a&&a.processFunc(i.params.result)}else console.warn("this should not happen")};const r=setInterval(()=>{this.emit("poll")},1e3);r.unref&&r.unref()}get websocket(){return this._websocket}detectNetwork(){return this._detectNetwork}get pollingInterval(){return 0}resetEventsBlock(t){A.throwError("cannot reset events block on WebSocketProvider",d.errors.UNSUPPORTED_OPERATION,{operation:"resetEventBlock"})}set pollingInterval(t){A.throwError("cannot set polling interval on WebSocketProvider",d.errors.UNSUPPORTED_OPERATION,{operation:"setPollingInterval"})}poll(){return L(this,void 0,void 0,function*(){return null})}set polling(t){t&&A.throwError("cannot set polling on WebSocketProvider",d.errors.UNSUPPORTED_OPERATION,{operation:"setPolling"})}send(t,e){const r=ge++;return new Promise((o,s)=>{function i(c,l){return c?s(c):o(l)}const a=JSON.stringify({method:t,params:e,id:r,jsonrpc:"2.0"});this.emit("debug",{action:"request",request:JSON.parse(a),provider:this}),this._requests[String(r)]={callback:i,payload:a},this._wsReady&&this.websocket.send(a)})}static defaultUrl(){return"ws://localhost:8546"}_subscribe(t,e,r){return L(this,void 0,void 0,function*(){let o=this._subIds[t];o==null&&(o=Promise.all(e).then(i=>this.send("eth_subscribe",i)),this._subIds[t]=o);const s=yield o;this._subs[s]={tag:t,processFunc:r}})}_startEvent(t){switch(t.type){case"block":this._subscribe("block",["newHeads"],e=>{const r=ne.from(e.number).toNumber();this._emitted.block=r,this.emit("block",r)});break;case"pending":this._subscribe("pending",["newPendingTransactions"],e=>{this.emit("pending",e)});break;case"filter":this._subscribe(t.tag,["logs",this._getFilter(t.filter)],e=>{e.removed==null&&(e.removed=!1),this.emit(t.filter,this.formatter.filterLog(e))});break;case"tx":{const e=r=>{const o=r.hash;this.getTransactionReceipt(o).then(s=>{s&&this.emit(o,s)})};e(t),this._subscribe("tx",["newHeads"],r=>{this._events.filter(o=>o.type==="tx").forEach(e)});break}case"debug":case"poll":case"willPoll":case"didPoll":case"error":break;default:console.log("unhandled:",t);break}}_stopEvent(t){let e=t.tag;if(t.type==="tx"){if(this._events.filter(o=>o.type==="tx").length)return;e="tx"}else if(this.listenerCount(t.event))return;const r=this._subIds[e];r&&(delete this._subIds[e],r.then(o=>{this._subs[o]&&(delete this._subs[o],this.send("eth_unsubscribe",[o]))}))}destroy(){return L(this,void 0,void 0,function*(){this.websocket.readyState===I.CONNECTING&&(yield new Promise(t=>{this.websocket.onopen=function(){t(!0)},this.websocket.onerror=function(){t(!1)}})),this.websocket.close(1e3)})}}const K=new d(b),B="_gg7wSSi0KMBsdKnGVfHDueq6xMB9EkC";class me extends W{constructor(t,e){const r=new ce(t,e),o=r.connection.url.replace(/^http/i,"ws").replace(".alchemyapi.",".ws.alchemyapi.");super(o,r.network),g(this,"apiKey",r.apiKey)}isCommunityResource(){return this.apiKey===B}}class ce extends P{static getWebSocketProvider(t,e){return new me(t,e)}static getApiKey(t){return t==null?B:(t&&typeof t!="string"&&K.throwArgumentError("invalid apiKey","apiKey",t),t)}static getUrl(t,e){let r=null;switch(t.name){case"homestead":r="eth-mainnet.alchemyapi.io/v2/";break;case"goerli":r="eth-goerli.g.alchemy.com/v2/";break;case"matic":r="polygon-mainnet.g.alchemy.com/v2/";break;case"maticmum":r="polygon-mumbai.g.alchemy.com/v2/";break;case"arbitrum":r="arb-mainnet.g.alchemy.com/v2/";break;case"arbitrum-goerli":r="arb-goerli.g.alchemy.com/v2/";break;case"optimism":r="opt-mainnet.g.alchemy.com/v2/";break;case"optimism-goerli":r="opt-goerli.g.alchemy.com/v2/";break;default:K.throwArgumentError("unsupported network","network",arguments[0])}return{allowGzip:!0,url:"https://"+r+e,throttleCallback:(o,s)=>(e===B&&$(),Promise.resolve(!0))}}isCommunityResource(){return this.apiKey===B}}const be=new d(b),j="9f7d929b018cdffb338517efa06f58359e86ff1ffd350bc889738523659e7972";function we(n){switch(n){case"homestead":return"rpc.ankr.com/eth/";case"ropsten":return"rpc.ankr.com/eth_ropsten/";case"rinkeby":return"rpc.ankr.com/eth_rinkeby/";case"goerli":return"rpc.ankr.com/eth_goerli/";case"matic":return"rpc.ankr.com/polygon/";case"arbitrum":return"rpc.ankr.com/arbitrum/"}return be.throwArgumentError("unsupported network","name",n)}class ke extends P{isCommunityResource(){return this.apiKey===j}static getApiKey(t){return t??j}static getUrl(t,e){e==null&&(e=j);const r={allowGzip:!0,url:"https://"+we(t.name)+e,throttleCallback:(o,s)=>(e.apiKey===j&&$(),Promise.resolve(!0))};return e.projectSecret!=null&&(r.user="",r.password=e.projectSecret),r}}var ye=globalThis&&globalThis.__awaiter||function(n,t,e,r){function o(s){return s instanceof e?s:new e(function(i){i(s)})}return new(e||(e=Promise))(function(s,i){function a(u){try{l(r.next(u))}catch(f){i(f)}}function c(u){try{l(r.throw(u))}catch(f){i(f)}}function l(u){u.done?s(u.value):o(u.value).then(a,c)}l((r=r.apply(n,t||[])).next())})};const z=new d(b);class Ee extends P{static getApiKey(t){return t!=null&&z.throwArgumentError("apiKey not supported for cloudflare","apiKey",t),null}static getUrl(t,e){let r=null;switch(t.name){case"homestead":r="https://cloudflare-eth.com/";break;default:z.throwArgumentError("unsupported network","network",arguments[0])}return r}perform(t,e){const r=Object.create(null,{perform:{get:()=>super.perform}});return ye(this,void 0,void 0,function*(){return t==="getBlockNumber"?(yield r.perform.call(this,"getBlock",{blockTag:"latest"})).number:r.perform.call(this,t,e)})}}var O=globalThis&&globalThis.__awaiter||function(n,t,e,r){function o(s){return s instanceof e?s:new e(function(i){i(s)})}return new(e||(e=Promise))(function(s,i){function a(u){try{l(r.next(u))}catch(f){i(f)}}function c(u){try{l(r.throw(u))}catch(f){i(f)}}function l(u){u.done?s(u.value):o(u.value).then(a,c)}l((r=r.apply(n,t||[])).next())})};const w=new d(b);function V(n){const t={};for(let e in n){if(n[e]==null)continue;let r=n[e];e==="type"&&r===0||({type:!0,gasLimit:!0,gasPrice:!0,maxFeePerGs:!0,maxPriorityFeePerGas:!0,nonce:!0,value:!0}[e]?r=le(H(r)):e==="accessList"?r="["+ue(r).map(o=>`{address:"${o.address}",storageKeys:["${o.storageKeys.join('","')}"]}`).join(",")+"]":r=H(r),t[e]=r)}return t}function ve(n){if(n.status==0&&(n.message==="No records found"||n.message==="No transactions found"))return n.result;if(n.status!=1||typeof n.message!="string"||!n.message.match(/^OK/)){const t=new Error("invalid response");throw t.result=JSON.stringify(n),(n.result||"").toLowerCase().indexOf("rate limit")>=0&&(t.throttleRetry=!0),t}return n.result}function X(n){if(n&&n.status==0&&n.message=="NOTOK"&&(n.result||"").toLowerCase().indexOf("rate limit")>=0){const t=new Error("throttled response");throw t.result=JSON.stringify(n),t.throttleRetry=!0,t}if(n.jsonrpc!="2.0"){const t=new Error("invalid response");throw t.result=JSON.stringify(n),t}if(n.error){const t=new Error(n.error.message||"unknown error");throw n.error.code&&(t.code=n.error.code),n.error.data&&(t.data=n.error.data),t}return n.result}function Q(n){if(n==="pending")throw new Error("pending not supported");return n==="latest"?n:parseInt(n.substring(2),16)}function F(n,t,e){if(n==="call"&&t.code===d.errors.SERVER_ERROR){const o=t.error;if(o&&(o.message.match(/reverted/i)||o.message.match(/VM execution error/i))){let s=o.data;if(s&&(s="0x"+s.replace(/^.*0x/i,"")),y(s))return s;w.throwError("missing revert data in call exception",d.errors.CALL_EXCEPTION,{error:t,data:"0x"})}}let r=t.message;throw t.code===d.errors.SERVER_ERROR&&(t.error&&typeof t.error.message=="string"?r=t.error.message:typeof t.body=="string"?r=t.body:typeof t.responseText=="string"&&(r=t.responseText)),r=(r||"").toLowerCase(),r.match(/insufficient funds/)&&w.throwError("insufficient funds for intrinsic transaction cost",d.errors.INSUFFICIENT_FUNDS,{error:t,method:n,transaction:e}),r.match(/same hash was already imported|transaction nonce is too low|nonce too low/)&&w.throwError("nonce has already been used",d.errors.NONCE_EXPIRED,{error:t,method:n,transaction:e}),r.match(/another transaction with same nonce/)&&w.throwError("replacement fee too low",d.errors.REPLACEMENT_UNDERPRICED,{error:t,method:n,transaction:e}),r.match(/execution failed due to an exception|execution reverted/)&&w.throwError("cannot estimate gas; transaction may fail or may require manual gas limit",d.errors.UNPREDICTABLE_GAS_LIMIT,{error:t,method:n,transaction:e}),t}class _e extends se{constructor(t,e){super(t),g(this,"baseUrl",this.getBaseUrl()),g(this,"apiKey",e||null)}getBaseUrl(){switch(this.network?this.network.name:"invalid"){case"homestead":return"https://api.etherscan.io";case"goerli":return"https://api-goerli.etherscan.io";case"sepolia":return"https://api-sepolia.etherscan.io";case"matic":return"https://api.polygonscan.com";case"maticmum":return"https://api-testnet.polygonscan.com";case"arbitrum":return"https://api.arbiscan.io";case"arbitrum-goerli":return"https://api-goerli.arbiscan.io";case"optimism":return"https://api-optimistic.etherscan.io";case"optimism-goerli":return"https://api-goerli-optimistic.etherscan.io"}return w.throwArgumentError("unsupported network","network",this.network.name)}getUrl(t,e){const r=Object.keys(e).reduce((s,i)=>{const a=e[i];return a!=null&&(s+=`&${i}=${a}`),s},""),o=this.apiKey?`&apikey=${this.apiKey}`:"";return`${this.baseUrl}/api?module=${t}${r}${o}`}getPostUrl(){return`${this.baseUrl}/api`}getPostData(t,e){return e.module=t,e.apikey=this.apiKey,e}fetch(t,e,r){return O(this,void 0,void 0,function*(){const o=r?this.getPostUrl():this.getUrl(t,e),s=r?this.getPostData(t,e):null,i=t==="proxy"?X:ve;this.emit("debug",{action:"request",request:o,provider:this});const a={url:o,throttleSlotInterval:1e3,throttleCallback:(u,f)=>(this.isCommunityResource()&&$(),Promise.resolve(!0))};let c=null;s&&(a.headers={"content-type":"application/x-www-form-urlencoded; charset=UTF-8"},c=Object.keys(s).map(u=>`${u}=${s[u]}`).join("&"));const l=yield ie(a,c,i||X);return this.emit("debug",{action:"response",request:o,response:R(l),provider:this}),l})}detectNetwork(){return O(this,void 0,void 0,function*(){return this.network})}perform(t,e){const r=Object.create(null,{perform:{get:()=>super.perform}});return O(this,void 0,void 0,function*(){switch(t){case"getBlockNumber":return this.fetch("proxy",{action:"eth_blockNumber"});case"getGasPrice":return this.fetch("proxy",{action:"eth_gasPrice"});case"getBalance":return this.fetch("account",{action:"balance",address:e.address,tag:e.blockTag});case"getTransactionCount":return this.fetch("proxy",{action:"eth_getTransactionCount",address:e.address,tag:e.blockTag});case"getCode":return this.fetch("proxy",{action:"eth_getCode",address:e.address,tag:e.blockTag});case"getStorageAt":return this.fetch("proxy",{action:"eth_getStorageAt",address:e.address,position:e.position,tag:e.blockTag});case"sendTransaction":return this.fetch("proxy",{action:"eth_sendRawTransaction",hex:e.signedTransaction},!0).catch(o=>F("sendTransaction",o,e.signedTransaction));case"getBlock":if(e.blockTag)return this.fetch("proxy",{action:"eth_getBlockByNumber",tag:e.blockTag,boolean:e.includeTransactions?"true":"false"});throw new Error("getBlock by blockHash not implemented");case"getTransaction":return this.fetch("proxy",{action:"eth_getTransactionByHash",txhash:e.transactionHash});case"getTransactionReceipt":return this.fetch("proxy",{action:"eth_getTransactionReceipt",txhash:e.transactionHash});case"call":{if(e.blockTag!=="latest")throw new Error("EtherscanProvider does not support blockTag for call");const o=V(e.transaction);o.module="proxy",o.action="eth_call";try{return yield this.fetch("proxy",o,!0)}catch(s){return F("call",s,e.transaction)}}case"estimateGas":{const o=V(e.transaction);o.module="proxy",o.action="eth_estimateGas";try{return yield this.fetch("proxy",o,!0)}catch(s){return F("estimateGas",s,e.transaction)}}case"getLogs":{const o={action:"getLogs"};if(e.filter.fromBlock&&(o.fromBlock=Q(e.filter.fromBlock)),e.filter.toBlock&&(o.toBlock=Q(e.filter.toBlock)),e.filter.address&&(o.address=e.filter.address),e.filter.topics&&e.filter.topics.length>0&&(e.filter.topics.length>1&&w.throwError("unsupported topic count",d.errors.UNSUPPORTED_OPERATION,{topics:e.filter.topics}),e.filter.topics.length===1)){const a=e.filter.topics[0];(typeof a!="string"||a.length!==66)&&w.throwError("unsupported topic format",d.errors.UNSUPPORTED_OPERATION,{topic0:a}),o.topic0=a}const s=yield this.fetch("logs",o);let i={};for(let a=0;a<s.length;a++){const c=s[a];if(c.blockHash==null){if(i[c.blockNumber]==null){const l=yield this.getBlock(c.blockNumber);l&&(i[c.blockNumber]=l.hash)}c.blockHash=i[c.blockNumber]}}return s}case"getEtherPrice":return this.network.name!=="homestead"?0:parseFloat((yield this.fetch("stats",{action:"ethprice"})).ethusd)}return r.perform.call(this,t,e)})}getHistory(t,e,r){return O(this,void 0,void 0,function*(){const o={action:"txlist",address:yield this.resolveName(t),startblock:e??0,endblock:r??99999999,sort:"asc"};return(yield this.fetch("account",o)).map(i=>{["contractAddress","to"].forEach(function(c){i[c]==""&&delete i[c]}),i.creates==null&&i.contractAddress!=null&&(i.creates=i.contractAddress);const a=this.formatter.transactionResponse(i);return i.timeStamp&&(a.timestamp=parseInt(i.timeStamp)),a})})}isCommunityResource(){return this.apiKey==null}}function Pe(n){n=n.slice();for(let t=n.length-1;t>0;t--){const e=Math.floor(Math.random()*(t+1)),r=n[t];n[t]=n[e],n[e]=r}return n}var D=globalThis&&globalThis.__awaiter||function(n,t,e,r){function o(s){return s instanceof e?s:new e(function(i){i(s)})}return new(e||(e=Promise))(function(s,i){function a(u){try{l(r.next(u))}catch(f){i(f)}}function c(u){try{l(r.throw(u))}catch(f){i(f)}}function l(u){u.done?s(u.value):o(u.value).then(a,c)}l((r=r.apply(n,t||[])).next())})};const E=new d(b);function x(){return new Date().getTime()}function Y(n){let t=null;for(let e=0;e<n.length;e++){const r=n[e];if(r==null)return null;t?t.name===r.name&&t.chainId===r.chainId&&(t.ensAddress===r.ensAddress||t.ensAddress==null&&r.ensAddress==null)||E.throwArgumentError("provider mismatch","networks",n):t=r}return t}function Z(n,t){n=n.slice().sort();const e=Math.floor(n.length/2);if(n.length%2)return n[e];const r=n[e-1],o=n[e];return t!=null&&Math.abs(r-o)>t?null:(r+o)/2}function _(n){if(n===null)return"null";if(typeof n=="number"||typeof n=="boolean")return JSON.stringify(n);if(typeof n=="string")return n;if(ne.isBigNumber(n))return n.toString();if(Array.isArray(n))return JSON.stringify(n.map(t=>_(t)));if(typeof n=="object"){const t=Object.keys(n);return t.sort(),"{"+t.map(e=>{let r=n[e];return typeof r=="function"?r="[function]":r=_(r),JSON.stringify(e)+":"+r}).join(",")+"}"}throw new Error("unknown value type: "+typeof n)}let Te=1;function ee(n){let t=null,e=null,r=new Promise(i=>{t=function(){e&&(clearTimeout(e),e=null),i()},e=setTimeout(t,n)});const o=i=>(r=r.then(i),r);function s(){return r}return{cancel:t,getPromise:s,wait:o}}const Ne=[d.errors.CALL_EXCEPTION,d.errors.INSUFFICIENT_FUNDS,d.errors.NONCE_EXPIRED,d.errors.REPLACEMENT_UNDERPRICED,d.errors.UNPREDICTABLE_GAS_LIMIT],Re=["address","args","errorArgs","errorSignature","method","transaction"];function C(n,t){const e={weight:n.weight};return Object.defineProperty(e,"provider",{get:()=>n.provider}),n.start&&(e.start=n.start),t&&(e.duration=t-n.start),n.done&&(n.error?e.error=n.error:e.result=n.result||null),e}function Se(n,t){return function(e){const r={};e.forEach(s=>{const i=n(s.result);r[i]||(r[i]={count:0,result:s.result}),r[i].count++});const o=Object.keys(r);for(let s=0;s<o.length;s++){const i=r[o[s]];if(i.count>=t)return i.result}}}function Ie(n,t,e){let r=_;switch(t){case"getBlockNumber":return function(o){const s=o.map(a=>a.result);let i=Z(o.map(a=>a.result),2);if(i!=null)return i=Math.ceil(i),s.indexOf(i+1)>=0&&i++,i>=n._highestBlockNumber&&(n._highestBlockNumber=i),n._highestBlockNumber};case"getGasPrice":return function(o){const s=o.map(i=>i.result);return s.sort(),s[Math.floor(s.length/2)]};case"getEtherPrice":return function(o){return Z(o.map(s=>s.result))};case"getBalance":case"getTransactionCount":case"getCode":case"getStorageAt":case"call":case"estimateGas":case"getLogs":break;case"getTransaction":case"getTransactionReceipt":r=function(o){return o==null?null:(o=S(o),o.confirmations=-1,_(o))};break;case"getBlock":e.includeTransactions?r=function(o){return o==null?null:(o=S(o),o.transactions=o.transactions.map(s=>(s=S(s),s.confirmations=-1,s)),_(o))}:r=function(o){return o==null?null:_(o)};break;default:throw new Error("unknown method: "+t)}return Se(r,n.quorum)}function T(n,t){return D(this,void 0,void 0,function*(){const e=n.provider;return e.blockNumber!=null&&e.blockNumber>=t||t===-1?e:de(()=>new Promise((r,o)=>{setTimeout(function(){return e.blockNumber>=t?r(e):n.cancelled?r(null):r(void 0)},0)}),{oncePoll:e})})}function Ae(n,t,e,r){return D(this,void 0,void 0,function*(){let o=n.provider;switch(e){case"getBlockNumber":case"getGasPrice":return o[e]();case"getEtherPrice":if(o.getEtherPrice)return o.getEtherPrice();break;case"getBalance":case"getTransactionCount":case"getCode":return r.blockTag&&y(r.blockTag)&&(o=yield T(n,t)),o[e](r.address,r.blockTag||"latest");case"getStorageAt":return r.blockTag&&y(r.blockTag)&&(o=yield T(n,t)),o.getStorageAt(r.address,r.position,r.blockTag||"latest");case"getBlock":return r.blockTag&&y(r.blockTag)&&(o=yield T(n,t)),o[r.includeTransactions?"getBlockWithTransactions":"getBlock"](r.blockTag||r.blockHash);case"call":case"estimateGas":return r.blockTag&&y(r.blockTag)&&(o=yield T(n,t)),e==="call"&&r.blockTag?o[e](r.transaction,r.blockTag):o[e](r.transaction);case"getTransaction":case"getTransactionReceipt":return o[e](r.transactionHash);case"getLogs":{let s=r.filter;return(s.fromBlock&&y(s.fromBlock)||s.toBlock&&y(s.toBlock))&&(o=yield T(n,t)),o.getLogs(s)}}return E.throwError("unknown method error",d.errors.UNKNOWN_ERROR,{method:e,params:r})})}class je extends se{constructor(t,e){t.length===0&&E.throwArgumentError("missing providers","providers",t);const r=t.map((i,a)=>{if(he.isProvider(i)){const u=M(i)?2e3:750;return Object.freeze({provider:i,weight:1,stallTimeout:u,priority:1})}const c=S(i);c.priority==null&&(c.priority=1),c.stallTimeout==null&&(c.stallTimeout=M(i)?2e3:750),c.weight==null&&(c.weight=1);const l=c.weight;return(l%1||l>512||l<1)&&E.throwArgumentError("invalid weight; must be integer in [1, 512]",`providers[${a}].weight`,l),Object.freeze(c)}),o=r.reduce((i,a)=>i+a.weight,0);e==null?e=o/2:e>o&&E.throwArgumentError("quorum will always fail; larger than total weight","quorum",e);let s=Y(r.map(i=>i.provider.network));s==null&&(s=new Promise((i,a)=>{setTimeout(()=>{this.detectNetwork().then(i,a)},0)})),super(s),g(this,"providerConfigs",Object.freeze(r)),g(this,"quorum",e),this._highestBlockNumber=-1}detectNetwork(){return D(this,void 0,void 0,function*(){const t=yield Promise.all(this.providerConfigs.map(e=>e.provider.getNetwork()));return Y(t)})}perform(t,e){return D(this,void 0,void 0,function*(){if(t==="sendTransaction"){const c=yield Promise.all(this.providerConfigs.map(l=>l.provider.sendTransaction(e.signedTransaction).then(u=>u.hash,u=>u)));for(let l=0;l<c.length;l++){const u=c[l];if(typeof u=="string")return u}throw c[0]}this._highestBlockNumber===-1&&t!=="getBlockNumber"&&(yield this.getBlockNumber());const r=Ie(this,t,e),o=Pe(this.providerConfigs.map(S));o.sort((c,l)=>c.priority-l.priority);const s=this._highestBlockNumber;let i=0,a=!0;for(;;){const c=x();let l=o.filter(h=>h.runner&&c-h.start<h.stallTimeout).reduce((h,p)=>h+p.weight,0);for(;l<this.quorum&&i<o.length;){const h=o[i++],p=Te++;h.start=x(),h.staller=ee(h.stallTimeout),h.staller.wait(()=>{h.staller=null}),h.runner=Ae(h,s,t,e).then(m=>{h.done=!0,h.result=m,this.listenerCount("debug")&&this.emit("debug",{action:"request",rid:p,backend:C(h,x()),request:{method:t,params:R(e)},provider:this})},m=>{h.done=!0,h.error=m,this.listenerCount("debug")&&this.emit("debug",{action:"request",rid:p,backend:C(h,x()),request:{method:t,params:R(e)},provider:this})}),this.listenerCount("debug")&&this.emit("debug",{action:"request",rid:p,backend:C(h,null),request:{method:t,params:R(e)},provider:this}),l+=h.weight}const u=[];o.forEach(h=>{h.done||!h.runner||(u.push(h.runner),h.staller&&u.push(h.staller.getPromise()))}),u.length&&(yield Promise.race(u));const f=o.filter(h=>h.done&&h.error==null);if(f.length>=this.quorum){const h=r(f);if(h!==void 0)return o.forEach(p=>{p.staller&&p.staller.cancel(),p.cancelled=!0}),h;a||(yield ee(100).getPromise()),a=!1}const v=o.reduce((h,p)=>{if(!p.done||p.error==null)return h;const m=p.error.code;return Ne.indexOf(m)>=0&&(h[m]||(h[m]={error:p.error,weight:0}),h[m].weight+=p.weight),h},{});if(Object.keys(v).forEach(h=>{const p=v[h];if(p.weight<this.quorum)return;o.forEach(k=>{k.staller&&k.staller.cancel(),k.cancelled=!0});const m=p.error,G={};Re.forEach(k=>{m[k]!=null&&(G[k]=m[k])}),E.throwError(m.reason||m.message,h,G)}),o.filter(h=>!h.done).length===0)break}return o.forEach(c=>{c.staller&&c.staller.cancel(),c.cancelled=!0}),E.throwError("failed to meet quorum",d.errors.SERVER_ERROR,{method:t,params:e,results:o.map(c=>C(c)),provider:this})})}}const Oe=null,U=new d(b),N="84842078b09946638c03157f83405213";class xe extends W{constructor(t,e){const r=new ae(t,e),o=r.connection;o.password&&U.throwError("INFURA WebSocket project secrets unsupported",d.errors.UNSUPPORTED_OPERATION,{operation:"InfuraProvider.getWebSocketProvider()"});const s=o.url.replace(/^http/i,"ws").replace("/v3/","/ws/v3/");super(s,t),g(this,"apiKey",r.projectId),g(this,"projectId",r.projectId),g(this,"projectSecret",r.projectSecret)}isCommunityResource(){return this.projectId===N}}class ae extends P{static getWebSocketProvider(t,e){return new xe(t,e)}static getApiKey(t){const e={apiKey:N,projectId:N,projectSecret:null};return t==null||(typeof t=="string"?e.projectId=t:t.projectSecret!=null?(U.assertArgument(typeof t.projectId=="string","projectSecret requires a projectId","projectId",t.projectId),U.assertArgument(typeof t.projectSecret=="string","invalid projectSecret","projectSecret","[REDACTED]"),e.projectId=t.projectId,e.projectSecret=t.projectSecret):t.projectId&&(e.projectId=t.projectId),e.apiKey=e.projectId),e}static getUrl(t,e){let r=null;switch(t?t.name:"unknown"){case"homestead":r="mainnet.infura.io";break;case"goerli":r="goerli.infura.io";break;case"sepolia":r="sepolia.infura.io";break;case"matic":r="polygon-mainnet.infura.io";break;case"maticmum":r="polygon-mumbai.infura.io";break;case"optimism":r="optimism-mainnet.infura.io";break;case"optimism-goerli":r="optimism-goerli.infura.io";break;case"arbitrum":r="arbitrum-mainnet.infura.io";break;case"arbitrum-goerli":r="arbitrum-goerli.infura.io";break;default:U.throwError("unsupported network",d.errors.INVALID_ARGUMENT,{argument:"network",value:t})}const o={allowGzip:!0,url:"https://"+r+"/v3/"+e.projectId,throttleCallback:(s,i)=>(e.projectId===N&&$(),Promise.resolve(!0))};return e.projectSecret!=null&&(o.user="",o.password=e.projectSecret),o}isCommunityResource(){return this.projectId===N}}class Le extends q{send(t,e){const r={method:t,params:e,id:this._nextId++,jsonrpc:"2.0"};this._pendingBatch==null&&(this._pendingBatch=[]);const o={request:r,resolve:null,reject:null},s=new Promise((i,a)=>{o.resolve=i,o.reject=a});return this._pendingBatch.push(o),this._pendingBatchAggregator||(this._pendingBatchAggregator=setTimeout(()=>{const i=this._pendingBatch;this._pendingBatch=null,this._pendingBatchAggregator=null;const a=i.map(c=>c.request);return this.emit("debug",{action:"requestBatch",request:R(a),provider:this}),ie(this.connection,JSON.stringify(a)).then(c=>{this.emit("debug",{action:"response",request:a,response:c,provider:this}),i.forEach((l,u)=>{const f=c[u];if(f.error){const v=new Error(f.error.message);v.code=f.error.code,v.data=f.error.data,l.reject(v)}else l.resolve(f.result)})},c=>{this.emit("debug",{action:"response",error:c,request:a,provider:this}),i.forEach(l=>{l.reject(c)})})},10)),s}}const J=new d(b),Ce="ETHERS_JS_SHARED";class Be extends P{static getApiKey(t){return t&&typeof t!="string"&&J.throwArgumentError("invalid apiKey","apiKey",t),t||Ce}static getUrl(t,e){J.warn("NodeSmith will be discontinued on 2019-12-20; please migrate to another platform.");let r=null;switch(t.name){case"homestead":r="https://ethereum.api.nodesmith.io/v1/mainnet/jsonrpc";break;case"ropsten":r="https://ethereum.api.nodesmith.io/v1/ropsten/jsonrpc";break;case"rinkeby":r="https://ethereum.api.nodesmith.io/v1/rinkeby/jsonrpc";break;case"goerli":r="https://ethereum.api.nodesmith.io/v1/goerli/jsonrpc";break;case"kovan":r="https://ethereum.api.nodesmith.io/v1/kovan/jsonrpc";break;default:J.throwArgumentError("unsupported network","network",arguments[0])}return r+"?apiKey="+e}}const te=new d(b),re="62e1ad51b37b8e00394bda3b";class Ue extends P{static getApiKey(t){const e={applicationId:null,loadBalancer:!0,applicationSecretKey:null};return t==null?e.applicationId=re:typeof t=="string"?e.applicationId=t:t.applicationSecretKey!=null?(e.applicationId=t.applicationId,e.applicationSecretKey=t.applicationSecretKey):t.applicationId?e.applicationId=t.applicationId:te.throwArgumentError("unsupported PocketProvider apiKey","apiKey",t),e}static getUrl(t,e){let r=null;switch(t?t.name:"unknown"){case"goerli":r="eth-goerli.gateway.pokt.network";break;case"homestead":r="eth-mainnet.gateway.pokt.network";break;case"kovan":r="poa-kovan.gateway.pokt.network";break;case"matic":r="poly-mainnet.gateway.pokt.network";break;case"maticmum":r="polygon-mumbai-rpc.gateway.pokt.network";break;case"rinkeby":r="eth-rinkeby.gateway.pokt.network";break;case"ropsten":r="eth-ropsten.gateway.pokt.network";break;default:te.throwError("unsupported network",d.errors.INVALID_ARGUMENT,{argument:"network",value:t})}const o=`https://${r}/v1/lb/${e.applicationId}`,s={headers:{},url:o};return e.applicationSecretKey!=null&&(s.user="",s.password=e.applicationSecretKey),s}isCommunityResource(){return this.applicationId===re}}const oe=new d(b);function Fe(n,t){if(n==null&&(n="homestead"),typeof n=="string"){const r=n.match(/^(ws|http)s?:/i);if(r)switch(r[1].toLowerCase()){case"http":case"https":return new q(n);case"ws":case"wss":return new W(n);default:oe.throwArgumentError("unsupported URL scheme","network",n)}}const e=fe(n);return(!e||!e._defaultProvider)&&oe.throwError("unsupported getDefaultProvider network",d.errors.NETWORK_ERROR,{operation:"getDefaultProvider",network:n}),e._defaultProvider({FallbackProvider:je,AlchemyProvider:ce,AnkrProvider:ke,CloudflareProvider:Ee,EtherscanProvider:_e,InfuraProvider:ae,JsonRpcProvider:q,NodesmithProvider:Be,PocketProvider:Ue,Web3Provider:pe,IpcProvider:Oe},t)}export{ce as AlchemyProvider,me as AlchemyWebSocketProvider,ke as AnkrProvider,se as BaseProvider,Ee as CloudflareProvider,_e as EtherscanProvider,je as FallbackProvider,Ge as Formatter,ae as InfuraProvider,xe as InfuraWebSocketProvider,Oe as IpcProvider,Le as JsonRpcBatchProvider,q as JsonRpcProvider,He as JsonRpcSigner,Be as NodesmithProvider,Ue as PocketProvider,he as Provider,Me as Resolver,Ve as StaticJsonRpcProvider,P as UrlJsonRpcProvider,pe as Web3Provider,W as WebSocketProvider,Fe as getDefaultProvider,fe as getNetwork,Ke as isCommunityResourcable,M as isCommunityResource,$ as showThrottleMessage};
